<!DOCTYPE html>
<!-- saved from url=(0071)http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>如何编写loader | webpack doc</title>
        
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.2">
        
        
        <meta name="HandheldFriendly" content="true">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://stephenzhao.github.io/webpack-cn/gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="http://stephenzhao.github.io/webpack-cn/gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="./如何编写loader _ webpack doc_files/style.css">
    
        
        <link rel="stylesheet" href="./如何编写loader _ webpack doc_files/website.css">
        
    
        
        <link rel="stylesheet" href="./如何编写loader _ webpack doc_files/search.css">
        
    
        
        <link rel="stylesheet" href="./如何编写loader _ webpack doc_files/website(1).css">
        
    
    

        
    
    
    <link rel="next" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-plugin.html">
    
    
    <link rel="prev" href="http://stephenzhao.github.io/webpack-cn/docs/long-term-caching.html">
    

        
    </head>
    <body>
        
        
    <div class="book without-animation with-summary font-size-2 font-family-1" data-level="4.8" data-chapter-title="如何编写loader" data-filepath="docs/how-to-write-a-loader.md" data-basepath=".." data-revision="Mon Jun 13 2016 18:05:17 GMT+0800 (CST)" data-innerlanguage="">
    

<div class="book-summary"><div class="book-search" role="search"><input type="text" class="form-control" placeholder="Type to search"></div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/index.html">
                
                        <i class="fa fa-check"></i>
                        
                        关于文档
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="docs/Home.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/Home.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        概览
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2">
            
            <span><b>2.</b> 开始</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="docs/motivation.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/motivation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        动机
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="docs/what-is-webpack.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/what-is-webpack.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        webpack是什么
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="docs/installation.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        安装
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="docs/usage.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/usage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        用法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5">
            
            <span><b>2.5.</b> Require Modules</span>
            
            
        </li>
    
        <li class="chapter " data-level="2.6">
            
            <span><b>2.6.</b> Vendor Modules</span>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="docs/using-loaders.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/using-loaders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        使用 Loaders
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="docs/using-plugins.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/using-plugins.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        使用 Plugins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="docs/dev-tools.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/dev-tools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        工具
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="docs/troubleshooting.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/troubleshooting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.10.</b>
                        
                        故障处理
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3">
            
            <span><b>3.</b> 教程与例子</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1">
            
                
                    <a target="_blank" href="http://stephenzhao.github.io/webpack.github.io/docs/tutorials/docs/getting-started.md">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        开始
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="docs/list-of-tutorials.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/list-of-tutorials.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        教程列表
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="docs/examples.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/examples.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        示例
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4">
            
            <span><b>4.</b> 指南</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="docs/commonjs.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/commonjs.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        CommonJs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="docs/amd.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/amd.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        AMD
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="docs/webpack-for-browserify-users.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/webpack-for-browserify-users.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        对于browserify用户
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="docs/code-splitting.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/code-splitting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        代码拆分
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="docs/stylesheets.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/stylesheets.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Stylesheets
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="docs/optimization.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/optimization.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        性能优化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="docs/long-term-caching.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/long-term-caching.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        长期缓存
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="4.8" data-path="docs/how-to-write-a-loader.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        如何编写loader
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="docs/how-to-write-a-plugin.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-plugin.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        如何编写插件
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="docs/multiple-entry-points.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/multiple-entry-points.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.10.</b>
                        
                        多入口点
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="docs/library-and-externals.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/library-and-externals.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.11.</b>
                        
                        库和扩展
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="docs/shimming-modules.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/shimming-modules.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.12.</b>
                        
                        Shimming modules
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="docs/testing.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/testing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.13.</b>
                        
                        测试
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="docs/build-performance.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/build-performance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.14.</b>
                        
                        构建性能
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.15" data-path="docs/hot-module-replacement-with-webpack.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/hot-module-replacement-with-webpack.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.15.</b>
                        
                        热替换
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.16" data-path="docs/comparison.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/comparison.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.16.</b>
                        
                        Comparison
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5">
            
            <span><b>5.</b> webpack with</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="docs/usage-with-grunt.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/usage-with-grunt.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        grunt | Usage with grunt
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="docs/usage-with-gulp.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/usage-with-gulp.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        gulp | 使用gulp
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="docs/usage-with-bower.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/usage-with-bower.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        bower | Usage with bower
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="docs/usage-with-karma.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/usage-with-karma.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        karma | Usage with karma
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6">
            
            <span><b>6.</b> Lists</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="docs/loader-conventions.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/loader-conventions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        loader conventions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="docs/list-of-loaders.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/list-of-loaders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        List of loaders
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="docs/list-of-plugins.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/list-of-plugins.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        List of plugins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="docs/list-of-hints.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/list-of-hints.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        List of hints
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="docs/configuration.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        配置
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="docs/cli.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/cli.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        CLI
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="docs/node.js-api.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/node.js-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        Node.js API
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="docs/api-in-modules.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/api-in-modules.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        API in modules
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="docs/loaders.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/loaders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        Loaders
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.10" data-path="docs/plugins.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/plugins.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.10.</b>
                        
                        Plugins
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.11" data-path="docs/context.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/context.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.11.</b>
                        
                        Context
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.12" data-path="docs/resolving.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/resolving.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.12.</b>
                        
                        Resolving
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.13" data-path="docs/hot-module-replacement.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/hot-module-replacement.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.13.</b>
                        
                        Hot Module Replacement
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.14">
            
            <span><b>6.14.</b> Dev Tools</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.14.1" data-path="docs/webpack-dev-server.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/webpack-dev-server.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.14.1.</b>
                        
                        webpack-dev-server
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.14.2" data-path="docs/webpack-dev-middleware.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/webpack-dev-middleware.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.14.2.</b>
                        
                        webpack-dev-middleware
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7">
            
            <span><b>7.</b> Development</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="docs/changelog.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/changelog.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Changelog
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="docs/roadmap.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/roadmap.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Roadmap
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="docs/ideas.html">
            
                
                    <a href="http://stephenzhao.github.io/webpack-cn/docs/ideas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Ideas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4">
            
            <span><b>7.4.</b> Contributing</span>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com/" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <a class="btn pull-left js-toolbar-action" aria-label="" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-align-justify"></i></a><a class="btn pull-left js-toolbar-action" aria-label="Search" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-search"></i></a><div class="dropdown pull-right  js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Share" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-share-alt"></i></a><div class="dropdown-menu dropdown-left"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-5 ">Facebook</button><button class="button size-5 ">Google+</button><button class="button size-5 ">Twitter</button><button class="button size-5 ">Weibo</button><button class="button size-5 ">Instapaper</button></div></div></div><a class="btn pull-right js-toolbar-action" aria-label="" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-facebook"></i></a><a class="btn pull-right js-toolbar-action" aria-label="" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-twitter"></i></a><div class="dropdown pull-left font-settings js-toolbar-action"><a class="btn toggle-dropdown" aria-label="Font Settings" href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-loader.html#"><i class="fa fa-font"></i></a><div class="dropdown-menu dropdown-right"><div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div><div class="buttons"><button class="button size-2 font-reduce">A</button><button class="button size-2 font-enlarge">A</button></div><div class="buttons"><button class="button size-2 ">Serif</button><button class="button size-2 ">Sans</button></div><div class="buttons"><button class="button size-3 ">White</button><button class="button size-3 ">Sepia</button><button class="button size-3 ">Night</button></div></div></div><h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="http://stephenzhao.github.io/webpack-cn/">webpack doc</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="如何编写webpack-loader">如何编写webpack loader</h2>
<p>webpack的loader是一个node module 导出的一个用于转化加载的资源的 <code>function</code>.</p>
<p>在简单的情况下，当只有一个加载器被执行的时候，其参数为资源文件的内容串。</p>
<p>加载器可以通过<code>this</code>上下文来访问<a href="http://stephenzhao.github.io/webpack-cn/docs/loaders.html">loader API</a>。
仅仅需要一个只值的同步加载器能很容易 <code>return</code> 它。在别的情况下，加载器可以通过<code>this.callback(err, values...)</code> 方法来返回。异常和错误会被<code>this.callback</code>传递或者被同步加载器抛出。</p>
<p>加载器期望返回一个或两个值，第一个是被转化的js串或者是buffer。第二个可选是js的<code>SourceMap</code> 
更复杂的情况是，当很多个加载器串联的时候，只有最后一个加载器拿到资源文件，并且只有第一个加载器能觉得返回一个还是两个值（<code>js</code> 和<code>SourceMap</code>）.其他loader的返回值都是从上一层级传递过来的。</p>
<h2 id="例子">例子</h2>
<pre><code class="lang-js">    <span class="hljs-comment">// Identity loader</span>
    <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) </span>{
      <span class="hljs-keyword">return</span> source;
    };

    <span class="hljs-comment">// Identity loader with SourceMap support</span>
    <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, map</span>) </span>{
      <span class="hljs-keyword">this</span>.callback(<span class="hljs-literal">null</span>, source, map);
    };
</code></pre>
<h2 id="指南">指南</h2>
<p>安处理顺序排列</p>
<p>加载器应该具备</p>
<h3 id="只关心一个任务">只关心一个任务</h3>
<p>加载器可以被串联，所以要分部实现加载器，而不是一个加载器把所有事情都做了。
这也就意味着，他们没必要都被转化为js</p>
<p>Example: Render HTML from a template file by applying the query parameters
比如：我们要通过设置参数来将模板渲染为HTML，
不好的做法：写一个加载器编译模板，执行并返回一个包含HTML代码的模块
相反，我们应该为每一个在这个案例里的任务写加载器，并且通过管道来加载他们。</p>
<ul>
<li>jade-loader: 将模板转化为一个node模块</li>
<li>apply-loader: 加载这个node模块并且按照请求返回资源</li>
<li>html-loader: 加载一个HTML文件，并且到处一个字符串模块</li>
</ul>
<h3 id="把所有模块变成模块化">把所有模块变成模块化</h3>
<p>Loader generated modules should respect the same design principles like normal modules.
加载器生成的模块应该遵循一般模块的设计原则，
错误的例子：（非 moduler，global state）</p>
<pre><code>   require("any-template-language-loader!./xyz.atl");

   var html = anyTemplateLanguage.render("xyz");
</code></pre><h3 id="把他标记为可缓存的">把他标记为可缓存的</h3>
<p>大多数加载器可缓存的，所以应该把他标记为可缓存的</p>
<p>Just call <code>cacheable</code> in the loader.
只需要调用<code>cacheable</code>函数就可以</p>
<pre><code class="lang-js">    <span class="hljs-comment">// Cacheable identity loader</span>
    <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">this</span>.cacheable();
        <span class="hljs-keyword">return</span> source;
    };
</code></pre>
<h3 id="not-keep-state-between-runs-and-modules">not keep state between runs and modules</h3>
<h3 id="别把让它处于代码组织者和模块之间">别把让它处于代码组织者和模块之间</h3>
<p>A loader should be independent of other modules compiled (expect of these issued by the loader).
一个加载器应该无须依赖其他模块来编译，也独立于之前编译模块</p>
<p>A loader should be independent of previous compilations of the same module.</p>
<h3 id="标记好依赖">标记好依赖</h3>
<p>If a loader uses external resources (i. e. by reading from filesystem), they <strong>must</strong> tell about that. This information is used to invalidate cacheable loaders and recompile in watch mode.
如果加载器用到了额外的资源（比如说读取文件系统），那么这些资源<strong>必须</strong>被告知。这些信息将用于区别可缓存加载器，还是在watch状态下的重编译</p>
<pre><code class="lang-js">    <span class="hljs-comment">// Loader adding a header</span>
    <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
    <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) </span>{
        <span class="hljs-keyword">this</span>.cacheable();
        <span class="hljs-keyword">var</span> callback = <span class="hljs-keyword">this</span>.async();
        <span class="hljs-keyword">var</span> headerPath = path.resolve(<span class="hljs-string">"header.js"</span>);
        <span class="hljs-keyword">this</span>.addDependency(headerPath);
        fs.readFile(headerPath, <span class="hljs-string">"utf-8"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, header</span>) </span>{
            <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">return</span> callback(err);
            callback(<span class="hljs-literal">null</span>, header + <span class="hljs-string">"\n"</span> + source);
        });
    };
</code></pre>
<h3 id="解决依赖">解决依赖</h3>
<p>在很多语言里都会有一下schema来指定依赖。比如在css中我们用<code>@import</code> <code>url</code>. 这些依赖管理应该通过模块系统解决
两点：</p>
<ul>
<li>把他们转化为<code>require</code>.</li>
<li>运用<code>this.resolve()</code>来解决路径问题.</li>
</ul>
<p>例1: 
  css-loader: 
  css-loader将依赖转换成<code>require</code>，通过<code>require</code>来替换<code>import</code>去加载别的样式表模块以及替代<code>url</code>去取资源文件.</p>
<p>例2:</p>
<p>  less-loader:</p>
<p>  less-loader不能直接将<code>@import</code>转化成<code>require</code>,因为所有的less文件需要被编译进一个通道里去跟踪<code>variables</code>和<code>mixins</code>。所以less－loader扩展了自己的路径解决逻辑。这个定制的逻辑运用了<code>this.resolve</code>函数去解决模块系统配置的文件路径。</p>
<p>如果某种语言只接受相对的urls（比如 css:<code>url(file)</code> 通常意味着<code>/file</code>)，所以有一个<code>~</code>符号来说明指向模块</p>
<pre><code class="lang-bash">    url(file) -&gt; require(<span class="hljs-string">"./file"</span>)
    url(~module) -&gt; require(<span class="hljs-string">"module"</span>)
</code></pre>
<h3 id="提取公用的模块">提取公用的模块</h3>
<p>不要初始化很多公用的模块代码在每一个加载器执行的模块，创建一个（运行时）文件在加载器里，并且通过<code>require</code>来加载他</p>
<h3 id="不要潜入绝对路径">不要潜入绝对路径</h3>
<p>不要把绝对路径放到模块的代码里面。这样当根目录被移动的时候会打破文件的哈希，有一个工具<code>stringifyRequest</code> 在<code>loader-utils</code>里面可以将绝对路径处理成相对路径</p>
<p>比如</p>
<pre><code class="lang-js">    <span class="hljs-keyword">var</span> loaderUtils = <span class="hljs-built_in">require</span>(<span class="hljs-string">"loader-utils"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"var runtime = require("</span> +
      loaderUtils.stringifyRequest(<span class="hljs-keyword">this</span>, <span class="hljs-string">"!"</span> + <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">"module/runtime"</span>)) +
      <span class="hljs-string">");"</span>;
</code></pre>
<h3 id="将使用的库作为peerdependencies来依赖">将使用的库作为<code>peerDependencies</code>来依赖</h3>
<p>使用<code>peerDependencies</code>可以允许应用开发者必要时在<code>package.json</code>去标示库的版本。依赖应该相对独立的去更新库而不用再发一个新的加载器版本</p>
<pre><code>    "peerDependencies": {
        "library": "^1.3.5"
    }
</code></pre><h3 id="可编程化对象作为参数">可编程化对象作为参数</h3>
<p>有些情况下你的加载器需要一些带有不可序列化的函数的可编程对象做为参数。
比如lessloader，提供了一个<code>LESS-plugins</code> 允许加载器去扩展webpack的<code>options</code>去检索特定的选项。为了避免名字冲突然，option是在加载器的npm驼峰名字域下的</p>
<pre><code class="lang-js">例子:

    <span class="hljs-comment">// webpack.config.js</span>
    <span class="hljs-built_in">module</span>.exports = {
      ...
      lessLoader: {
        lessPlugins: [
          <span class="hljs-keyword">new</span> LessPluginCleanCSS({advanced: <span class="hljs-literal">true</span>})
        ]
      }
    };
</code></pre>
<p>参考：<a href="http://stephenzhao.github.io/webpack-cn/docs/list-of-loaders.html">list of loaders</a></p>
<h2 id="阅读更多">阅读更多</h2>
<p> <a href="http://stephenzhao.github.io/webpack-cn/docs/loaders.html">loaders</a>.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="http://stephenzhao.github.io/webpack-cn/docs/long-term-caching.html" class="navigation navigation-prev " aria-label="Previous page: 长期缓存"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="http://stephenzhao.github.io/webpack-cn/docs/how-to-write-a-plugin.html" class="navigation navigation-next " aria-label="Next page: 如何编写插件" style="margin-right: 15px;"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="./如何编写loader _ webpack doc_files/app.js"></script>

    
    <script src="./如何编写loader _ webpack doc_files/lunr.min.js"></script>
    

    
    <script src="./如何编写loader _ webpack doc_files/search.js"></script>
    

    
    <script src="./如何编写loader _ webpack doc_files/buttons.js"></script>
    

    
    <script src="./如何编写loader _ webpack doc_files/buttons(1).js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    
    

</body></html>